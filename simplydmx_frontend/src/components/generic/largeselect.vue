<script lang="ts">
	export interface SelectOption {
		name: string,
		value: any,
	}
	export interface SelectEvent {
		value: any,
		event: MouseEvent,
	}
</script>

<script lang="ts" setup>
	import { ref, computed, type PropType, watch } from "vue";

	const props = defineProps({
		options: {
			type: Array as PropType<SelectOption[]>,
			required: true,
		},
		modelValue: {},
		enableSearch: {
			type: Boolean,
			required: false,
		},
	});

	const emit = defineEmits<{
		(e: "update:modelValue", value: any): void,
		(e: "select", event: SelectEvent): void,
	}>();

	watch(() => props.options, () => {
		// If the currently-selected option is not in the new list, deselect.
		if (!props.options.find((item) => item.value === props.modelValue)) {
			emit("update:modelValue", null);
		}
	})

	const search = ref("");
	const filteredOptions = computed(() => {
		if (!props.enableSearch) return props.options;
		return props.options.filter(({ name: label }) => label.toLowerCase().includes(search.value.toLowerCase()));
	});
	
	function dispatchSelect(value: any, event: MouseEvent) {
		emit("update:modelValue", value);
		emit("select", { value, event });
	}
</script>

<template>
	<div class="sdmx-largeselect">
		<div class="largeselect-header spaced">
			<Textbox
				v-if="props.enableSearch"
				v-model="search"
				hint="Search"
				class="largeselect-search"
				/>
			<slot name="header-right" />
		</div>
		<div
			v-for="option in filteredOptions"
			class="largeselect-option"
			:class="{ active: option.value === props.modelValue }"
			@click="dispatchSelect(option.value, $event)"
			>
			<slot name="option" :option="option">
				{{ option.name }}
			</slot>
		</div>
	</div>
</template>

<style lang="scss">
	.sdmx-largeselect {
		display: flex;
		flex-flow: column nowrap;
		justify-content: flex-start;
		align-items: stretch;
		background: var(--largeselect-background);
		
		& > .largeselect-header {
			display: flex;
			flex-flow: row nowrap;
			justify-content: center;
			align-items: center;
			gap: 0.75rem;

			& > .largeselect-search {
				flex: 1 1 0;
				width: 5rem;
			}
		}

		& > .largeselect-option {
			height: 3rem;
			cursor: pointer;
			user-select: none;
			-webkit-user-select: none;

			&.active {
				background: var(--largeselect-focused-background);
			}
			&:hover:not(.active) {
				background: var(--largeselect-hover-background);
			}

			display: flex;
			flex-flow: row nowrap;
			align-items: center;
			padding: 0.5rem;

			font-size: 1.125rem;
		}
	}
</style>
